<!DOCTYPE html>
<html lang="en" data-ng-app="app">
    <head>
        <meta charset="utf-8" />
        <title>小金风控</title>
        <link rel="stylesheet" href="../libs/jquery/bootstrap/dist/css/bootstrap.css" type="text/css" />

        <!-- build:css css/app.min.css -->
        <link rel="stylesheet" href="/fengkongweishi/css/font.css" type="text/css" />
        <link rel="stylesheet" href="/fengkongweishi/css/app.css" type="text/css" />
        <link rel="stylesheet" href="/fengkongweishi/css/style.css" type="text/css" />
        <!-- endbuild -->
     
    </head>
    <body ng-controller="AppCtrl">
        <div class="all_wrap">
            <div class="header_wrap" style="-webkit-app-region: drag">
                <div class="menu_wrap pull-left">
                    <table class="menu_table" width="100%">
                        <tr>
                            <!--<td>-->
                                <!--<a>-->
                                    <!--<img src="/fengkongweishi/images/menu_welcome.png" alt="person" width="45" /> -->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a>-->
                                    <!--<img src="/fengkongweishi/images/menu_1.png" alt="person" width="45" /> -->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a>-->
                                    <!--<img src="/fengkongweishi/images/menu_2.png" alt="person" width="45" /> -->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a>-->
                                    <!--<img src="/fengkongweishi/images/menu_3.png" alt="person" width="45" /> -->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a>-->
                                    <!--<img src="/fengkongweishi/images/menu_4.png" alt="person" width="45" /> -->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a>-->
                                    <!--<img src="/fengkongweishi/images/menu_5.png" alt="person" width="45" /> -->
                                <!--</a>-->
                            <!--</td>-->
                        </tr>
                        <tr>
                            <!--<td>-->
                                <!--<a  href="/">-->
                                    <!--首页-->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a  style="color:#999">-->
                                    <!--个信速查-->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a  style="color:#999">-->
                                    <!--个信慢查-->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a  style="color:#999">-->
                                    <!--企业信用-->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a  style="color:#999">-->
                                    <!--电商信用-->
                                <!--</a>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<a style="color:#999">-->
                                    <!--职前调查-->
                                <!--</a>-->
                            <!--</td>-->
                        </tr>
                    </table>              
                </div>
                <div class="pull-right" style="padding:70px 0 0 0;color:#eaeaea;">
                    欢迎您，请 <a href="/register"><b>注册</b></a> 或 <a href="/login"><b>登录</b></a> 小金风控
                </div>
            </div>
            
            
            <!--<div class="body_wrap" ng-controller="registerCtrl">-->
                <!---->

                <!--<table width="100%">-->
                    <!--<tr>-->
                        <!--<td width="10%">-->
                            <!--&nbsp;-->
                        <!--</td>-->
                        <!--<td width="45%" style="vertical-align: top;">-->
                            <!--<div style="font-size: 18px;">找回密码</div>-->
                            <!--<br />-->
                                 <!---->
                            <!--<form class="form-horizontal">-->
                            <!---->
                                <!--<div class="form-group">-->
                                    <!--<label class="col-lg-2 control-label">手机</label>-->
                                    <!--<div class="col-lg-5">-->
                                        <!--<input class="form-control" name="username" ng-model="personPredata.username" placeholder="11位手机号" type="text">-->
                                    <!--</div>-->
                                     <!--<div class="col-lg-5" style="margin-left: -25px;">-->
                                        <!--<span ng-cloak class="text-danger" ng-show="personPredata.username.length != 11 && personPredata.username.length > 0"><i class="fa fa-ban"></i> 11位手机号</span>-->
                                        <!--<span ng-cloak class="text-success" ng-show="personPredata.username.length == 11"><i class="fa fa-check"></i> 11位手机号</span>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="form-group">-->
                                    <!--<label class="col-lg-2 control-label">验证码</label>-->
                                    <!--<div class="col-lg-5">-->
                                        <!--<input class="form-control" name="sms" ng-model="personPredata.sms"  placeholder="验证码" type="text">-->
                                    <!--</div>-->
                                    <!--<div class="col-lg-5" style="margin-left: -25px;">-->
                                        <!--<button  class="btn btn-default" ng-hide="personSendSMSPending"  ng-click="personSms()">获取验证码</button>-->
                                        <!--<button ng-cloak  class="btn btn-default disabled" ng-show="personSendSMSPending">{{personSendSMSText}}</button>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="form-group">-->
                                    <!--<label class="col-lg-2 control-label">登录密码</label>-->
                                    <!--<div class="col-lg-5">-->
                                        <!--<input class="form-control" name="password1"  ng-model="personPredata.password1"  placeholder="密码" type="password">-->
                                    <!--</div>-->
                                    <!--<div class="col-lg-5" style="margin-left: -25px;">-->
                                        <!--<span ng-cloak class="text-danger" ng-show="personPredata.password1.length <6 && personPredata.password1.length > 0"><i class="fa fa-ban"></i> 密码需要6位以上</span>-->
                                        <!--<span ng-cloak class="text-success" ng-show="personPredata.password1.length >5"><i class="fa fa-check"></i> 正确</span>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="form-group">-->
                                    <!--<label class="col-lg-2 control-label">确认密码</label>-->
                                    <!--<div class="col-lg-5">-->
                                        <!--<input class="form-control" name="password2"  placeholder="确认密码"ng-model="personPredata.password2"   type="password">-->
                                    <!--</div>-->
                                     <!--<div class="col-lg-5" style="margin-left: -25px;">-->
                                        <!--<span ng-cloak class="text-success " ng-show="personPredata.password1.length >5 && personPredata.password1 == personPredata.password2"><i class="fa fa-check"></i> 密码相同</span>-->
                                        <!--<span ng-cloak class="text-danger" ng-show="personPredata.password1.length >5 && personPredata.password1 != personPredata.password2"><i class="fa fa-check"></i> 密码不同</span>-->
                                    <!--</div>-->
                                <!--</div>-->
                                  <!--<div class="form-group">-->
                                    <!--<label class="col-lg-2 control-label"></label>-->
                                    <!--<div class="col-lg-6">-->
                                        <!--&nbsp;-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="form-group">-->
                                      <!--<div class="col-lg-offset-2 col-lg-10">-->
                                          <!--<button ng-cloak  class="btn btn-sm btn-info disabled" ng-if="personPredata.username.length != 11 || personPredata.sms.length !=6 || personPredata.password1.length <6 ||  personPredata.password1 != personPredata.password2">确认</button>-->
                                          <!--<button  ng-click="personSubmit()" class="btn btn-sm btn-success" ng-if="personPredata.username.length == 11 && personPredata.sms.length == 6 && personPredata.password1.length >5  &&  personPredata.password1 == personPredata.password2">确认</button>-->
                                      <!--</div>-->
                                <!--</div>-->
                          <!--</form>-->
                        <!--</td>-->
                        <!--<td width="45%"  style="vertical-align:  top;">-->
                              <!---->
                        <!--</td>-->
                    <!--</tr>-->
                <!--</table>-->
                <!--<div class="footer_wrap">-->
                    <!--<div class="pull-right">-->
                        <!--杭州商道科技有限公司 &nbsp;-->
                        <!--0571-56932575-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <div class="body_wrap paddingTop35" ng-controller="registerCtrl">
                <div class="warp_content">
                    <table width="100%">
                        <tr>
                            <td width="100%" style="vertical-align: top;">
                                <div class="auth_title_warp" style="width: 140px">
                                    <img src="/fengkongweishi/images/Authentication.png" height="30" width="26"/>
                                    <div class="auth_title">找回密码</div>
                                </div>

                                <div class="vbox">
                                    <div class="row-row">
                                        <div class="cell">
                                            <div class="cell-inner" style="overflow: visible">
                                                <form class="form-horizontal valid-form" style="width: 600px; margin: 0 auto">
                                                    <div class="valid-form-item" style="left: 210px">
                                                        <div>
                                                            <span ng-cloak class="text-danger" ng-show="personPredata.username.length != 11 && personPredata.username.length > 0"><i class="fa fa-ban"></i> 11位手机号</span>
                                                        </div>
                                                        <div>
                                                            <span ng-cloak class="text-danger" ng-show="personPredata.password1.length <6 && personPredata.password1.length > 0"><i class="fa fa-ban"></i> 密码需要6位以上</span>
                                                        </div>
                                                        <div>
                                                            <span ng-cloak class="text-danger" ng-show="personPredata.password1.length >5 && personPredata.password1 != personPredata.password2"><i class="fa fa-check"></i> 密码不同</span>
                                                        </div>
                                                        <div>
                                                            <span ng-cloak class="text-danger" ng-show="error.errorMessageShow"><i class="fa fa-ban"></i> {{error.errorMessage}}</span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-4 control-label">手机</label>
                                                        <div class="col-lg-6">
                                                            <input class="form-control" name="username" ng-model="personPredata.username" placeholder="11位手机号" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-4 control-label">验证码</label>
                                                        <div class="col-lg-3" style="width: 28%">
                                                            <input class="form-control" name="sms" ng-model="personPredata.sms"  placeholder="验证码" type="text">
                                                        </div>
                                                        <div ng-cloak class="col-lg-4" style="margin-left: -20px;">
                                                            <button style="width: 129px"  class="btn btn-default" ng-hide="personSendSMSPending"  ng-click="personSms()">获取短信验证码</button>
                                                            <button style="padding: 6px 0;width: 129px" ng-cloak  class="btn btn-default disabled" ng-show="personSendSMSPending" ng-bind="personSendSMSText"></button>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-4 control-label">登录密码</label>
                                                        <div class="col-lg-6">
                                                            <input class="form-control" name="password1"  ng-model="personPredata.password1"  placeholder="密码" type="password">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-4 control-label">确认密码</label>
                                                        <div class="col-lg-6">
                                                            <input class="form-control" name="password2"  placeholder="确认密码"ng-model="personPredata.password2"   type="password">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-4 control-label"></label>
                                                        <div class="col-lg-6">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-lg-offset-4 col-lg-6" style="margin-left: 209px;;margin-top: 15px">
                                                            <button ng-cloak style="width: 100%;background: #4777B6;border: 1px solid #4777b6;"  ng-click="personSubmit()" class="btn btn-sm btn-success">确认</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </td>
                        </tr>
                    </table>
                </div>

                <div class="footer_wrap">
                    <div class="pull-right">
                        杭州商道科技有限公司 &nbsp;
                        0571-56932575
                    </div>
                </div>
            </div>
            
        </div>

        <!-- build:js js/app.angular.js -->
        <!-- jQuery -->
        <script src="../libs/jquery/jquery/dist/jquery.js"></script>
        <script>if (typeof module === 'object') {
                                    window.jQuery = window.$ = module.exports;
                                }
                                ;</script>
        <!-- Bootstrap -->
        <script src="../libs/jquery/bootstrap/dist/js/bootstrap.js"></script>
        <script src="../libs/jquery/bootstrap-paginator/bootstrap-paginator.min.js"></script>

        <!-- Angular -->
        <script src="../libs/angular/angular/angular.js"></script>

        <script src="../libs/angular/angular-animate/angular-animate.js"></script>
        <script src="../libs/angular/angular-aria/angular-aria.js"></script>
        <script src="../libs/angular/angular-cookies/angular-cookies.js"></script>
        <script src="../libs/angular/angular-messages/angular-messages.js"></script>
        <script src="../libs/angular/angular-resource/angular-resource.js"></script>
        <script src="../libs/angular/angular-sanitize/angular-sanitize.js"></script>
        <script src="../libs/angular/angular-touch/angular-touch.js"></script>

        <script type="text/javascript" src="../libs/layui/layui.js"></script>

        <script src="../libs/angular/angular-ui-router/release/angular-ui-router.js"></script> 
        <script src="../libs/angular/ngstorage/ngStorage.js"></script>
        <script src="../libs/angular/angular-ui-utils/ui-utils.js"></script>

        <!-- bootstrap -->
        <script src="../libs/angular/angular-bootstrap/ui-bootstrap-tpls.js"></script>
        <!-- lazyload -->
        <script src="../libs/angular/oclazyload/dist/ocLazyLoad.js"></script>
        <!-- translate -->
        <script src="../libs/angular/angular-translate/angular-translate.js"></script>
        <script src="../libs/angular/angular-translate-loader-static-files/angular-translate-loader-static-files.js"></script>
        <script src="../libs/angular/angular-translate-storage-cookie/angular-translate-storage-cookie.js"></script>
        <script src="../libs/angular/angular-translate-storage-local/angular-translate-storage-local.js"></script>

        <!-- App -->
        <script src="/fengkongweishi/js/app.js"></script>
        <script src="/fengkongweishi/js/config.js"></script>
        <script src="/fengkongweishi/js/config.lazyload.js"></script>
        <script src="/fengkongweishi/js/config.router.js"></script>
        <script src="/fengkongweishi/js/main.js"></script>
        <script src="/fengkongweishi/js/services/ui-load.js"></script>
        <script src="/fengkongweishi/js/filters/fromNow.js"></script>
        <script src="/fengkongweishi/js/directives/setnganimate.js"></script>
        <script src="/fengkongweishi/js/directives/ui-butterbar.js"></script>
        <script src="/fengkongweishi/js/directives/ui-focus.js"></script>
        <script src="/fengkongweishi/js/directives/ui-fullscreen.js"></script>
        <script src="/fengkongweishi/js/directives/ui-jq.js"></script>
        <script src="/fengkongweishi/js/directives/ui-module.js"></script>
        <script src="/fengkongweishi/js/directives/ui-nav.js"></script>
        <script src="/fengkongweishi/js/directives/ui-scroll.js"></script>
        <script src="/fengkongweishi/js/directives/ui-shift.js"></script>
        <script src="/fengkongweishi/js/directives/ui-toggleclass.js"></script>
        <script src="/fengkongweishi/js/controllers/bootstrap.js"></script>
        <!-- endbuild -->
        <!-- Lazy loading -->
   <script>

    "use strict";
    app.controller("registerCtrl", [
            "$scope", "$http", "$rootScope", '$state', '$interval', '$timeout', "$stateParams",
            function ($scope, $http, $rootScope, $state, $interval, $timeout, $stateParams) {
                
                $scope.personPredata = {
                    username:'',
                    sms:'',
                    password1:'',
                    password2:'',
                }

                $scope.type = '';

                $scope.personSeconds = 60;
                $scope.personSendSMSText = '获取验证码';
                $scope.personSendSMSPending = false;//验证码发送中的状态，60秒后可重发

                function vaildstr(str) {
                    $scope.error = {
                        errorMessageShow: true,
                        errorMessage: str
                    };
                    $timeout(function () {
                        $scope.error.errorMessageShow=false
                    },6000)

                }

                $scope.GetQueryString = function(name) {

                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");

                    var r = window.location.search.substr(1).match(reg);

                    if (r!=null) return unescape(r[2]); return null;

                }

                $scope.type = $scope.GetQueryString('type');

                 $scope.personSms = function(){
                     if($scope.personPredata.username.length !== 11){
                         vaildstr('请输入11位手机号，您输入'+ $scope.personPredata.username.length +'位')
                        
                     } else{
                            $http({method: "get", url: '/user/rePasswordSms?username=' + $scope.personPredata.username}).then(function (response) {
                               var resResult = response.data;
                               if (resResult.status == 'fail') {

                               } else {

                               }
                           }, function(){

                           });
                           $scope.personSendSMSPending =true;
                           $interval(function(){
                                $scope.personSeconds --;
                                $scope.personSendSMSText = $scope.personSeconds + '秒后可重新发送';
                            },1000,60).then(function(){
                                $scope.personSendSMSPending = false;
                                $scope.personSendSMSText = '获取验证码';
                                $scope.personSeconds = 60;
                            });
                    }
                }

                $scope.personSubmit = function(){
                     $http({method: "post", url: '/user/rePassword', data:$scope.personPredata}).then(function (response) {
                        console.log(response);
                        var resResult = response.data;
                        if (resResult.status == 'fail') {
                            vaildstr(resResult.message)
                            //$rootScope.infoBox(resResult.message);
                        } else {
                            $rootScope.infoBox("密码修改成功，请登录！")
                             window.location.href= '/login';
                        }

                    }, function(){

                    });
                }
            }
    ]);</script>
     
    </body>
</html>
