<script>
    "use strict";
    app.controller("employeeCtrl", [
            "$scope", "$http", "$rootScope", "$state",'$interval','$timeout',"$filter",
            function ($scope, $http, $rootScope, $state,$interval,$timeout,$filter) {

//          获取企业基本信息
                $scope.getCompanyInfo = function () {
                    $http.get("/company/myInfo").then(
                        function (result) {
                            $scope.companyInfo = result.data.data;
                        }
                    );
                };
                $scope.getCompanyInfo();


                $scope.managerVerify = {};

                $scope.personPredata={
                    username:'',
                    nickname:'',
                    sms:'',
                    password1:'',
                    password2:''
                };

                $scope.newTeam = {
                    name:'',
                    username:'',
                    nickname:'',
                    password1:'',
                    password2:''
                };
                $scope.changeTeam = {
                    turnsms:"",
                    changeTeam:""
                };

                $scope.errorMessage = {
                    message:'',
                    flag:false
                };

                $scope.companyFlag =false;
                $scope.consumptionsFlag =false;
                $scope.searchInfo = {
                    name: "",
                    phone: ""
                };
                $scope.clearSearchInfo = function () {
                    $scope.searchInfo ={
                        name:"",
                        phone:""
                    };
                    $scope.companyFlag = false;
                    $scope.getMemberList(7,0);
                };

    //          成员列表搜索
                $scope.searchMemberList = function () {
                    $scope.companyFlag = false;
                    $scope.getMemberList(7,0);
                };

    //          获取成员列表
                $scope.getMemberList = function(size,page){
                    $scope.members = [];
                    $('.membersList tr').remove();
                    $http({method:"GET",url:"/company/employeesList?size="+size+"&page=" + page+"&sort=company.id,role&sort=joinCompanyTime,desc" + "&name="+$scope.searchInfo.name +"&mobile="+$scope.searchInfo.phone}).then(
                        function (result) {
                            $('.membersList tr').remove();
                            result = result.data;
                            $scope.members = result.data.employeeList;
                            if(!$scope.companyFlag){
                                //分页功能
                                layui.use(['laypage', 'layer'], function(){
                                    var laypage = layui.laypage;
                                    laypage.render({
                                        elem: 'companyPage'
                                        ,count: result.data.totalElements
                                        ,theme:"#4777B6"
                                        ,limit: 7
                                        ,limits:[5,6,7]
                                        ,layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
                                        ,jump: function(obj,first){
                                            if(!first){
                                                $scope.getMemberList(obj.limit,obj.curr-1);
                                            }
                                        }
                                    });
                                });
                                $scope.companyFlag = true;
                            }
                        }
                    );
                };
                $scope.getMemberList(7,0);

                $scope.vaildstr = function(str) {
                    $scope.errorMessage = {
                        message: str,
                        flag: true
                    };
                    $timeout(function () {
                        $scope.error.errorMessageShow = false
                    }, 6000)
                };

                function vaildstr(str) {
                    $scope.error = {
                        errorMessageShow: true,
                        errorMessage: str
                    };
                    $timeout(function () {
                        $scope.error.errorMessageShow=false
                    },6000)

                }

            $scope.smsInit = function () {
                $scope.personSeconds = 60;
                $scope.personSendSMSText = '获取验证码';
                $scope.personSendSMSPending = false;//验证码发送中的状态，60秒后可重发
                if($scope.timer){
                    clearInterval($scope.timer);
                }
            };

            $scope.smsInit();

                $scope.personSms = function (phone) {
                    console.log(phone)
                    if(phone == undefined){
                        $scope.vaildstr('请输入正确的手机号')
                        vaildstr('请输入正确的手机号')
                        return false;
                    } else if (phone.length !== 11 ) {
//                        $scope.errorMessage = {
//                            message:'请输入11位手机号，您输入' + phone.length + '位',
//                            flag:true
//                        }
                        $scope.vaildstr('请输入11位手机号，您输入' + phone.length + '位')
                        vaildstr('请输入11位手机号，您输入' + phone.length + '位')
                        return false;
                    } else {
                        console.log('aaaaa')
                        $http({method: "get", url: '/user/registerSms?username=' + phone}).then(function (response) {
                            var resResult = response.data;
                            if (resResult.status === 'fail') {
                                vaildstr(resResult.message)
                                $scope.errorMessage = {
                                    message:resResult.message,
                                    flag:true
                                };
                                return 0;
                            } else {

                                $scope.personSendSMSPending = true;
                                $scope.timer = setInterval(function () {
                                    $scope.personSeconds--;
                                    $scope.personSendSMSText = $scope.personSeconds + '秒后可重新发送';
                                    if ($scope.personSeconds === 0) {
                                        $scope.personSendSMSPending = false;
                                        $scope.personSendSMSText = '获取短信验证码';
                                        $scope.personSeconds = 60;
                                        clearInterval($scope.timer);
                                    }
                                    $scope.$apply();
                                }, 1000)
                            }
                        });
                    }
                }

                $scope.leaderChange =function () {
                    $scope.newTeam.nickname ="";
                     if(!$scope.checkForm('phone')){
                         $scope.teamVerifyCode = false;
                     }else{
                        $http({method:"GET",url:"/company/user/show?username="+$scope.newTeam.username}).then(
                            function (result) {
                                console.log(result);
                                if (result.data.status === "success") {
                                    $scope.newTeam.nickname = result.data.data.nickname;
                                    $scope.teamVerifyCode = false;
                                    $scope.errorMessage = {
                                        flag: false,
                                        message:""
                                    };
                                }else {
                                    $scope.teamVerifyCode = true;
                                    $scope.errorMessage = {
                                        flag: true,
                                        message: "该用户不存在，请先注册"
                                    };
                                }
                            }
                        )
                    }
                };

                $scope.addTeam =function () {
                    $scope.httpInfo = null;
                    if($scope.checkForm('teamName') && $scope.checkForm('phone') && $scope.checkForm('name')){
                        if(!$scope.teamVerifyCode){
                            $scope.httpInfo = {
                                "method": "GET",
                                "url": "/company/addTeam?companyName=" + $scope.newTeam.name + "&userName="+$scope.newTeam.username+"&sms="+$scope.newTeam.sms
                            };
                        }else{
                            $scope.httpInfo ={
                                "method":"POST",
                                "url":"/company/registerAddTeam?companyName=" + $scope.newTeam.name,
                                "data":$scope.newTeam
                            };
                        }
                        console.log($scope.httpInfo);
                        $http($scope.httpInfo).then(
                            function (result) {
                                $timeout(function () {
                                    if(result.data.status === "fail"){
                                        $rootScope.infoBox(result.data.message);
                                    }else {
                                        $("#create_team").modal("hide");
                                        $rootScope.infoBox("添加成功");
                                        $scope.getCompanyInfo();
                                        $scope.teamFlag =false;
                                        $scope.getMemberList(7,0);
                                    }
                                },0,false)
                            })
                    }
                };

                //form check
                $scope.checkForm = function(index) {

                    var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;

                    if(index == 'teamName' ) {
                        if( $scope.newTeam.name.length>20 || $scope.newTeam.name == '' ) {
                            $scope.errorMessage = {
                                message:'团队名称不能为空且不超过20字',
                                flag:true
                            }
                            return false;
                        }else{
                            $scope.errorMessage = {
                                message:''
                            };
                            return true;
                        }
                    } else if(index == 'phone' && !myreg.test( $scope.newTeam.username)){
                        $scope.errorMessage = {
                            message:'请输入正确的手机号',
                            flag:true
                        };
                        return false;
                    }else if(index == 'name' && $scope.newTeam.nickname == '' ) {
                        $scope.errorMessage = {
                            message:'负责人姓名不能为空',
                            flag:true
                        };
                        return false;
                    }else if(index == 'pwd1') {
                        if($scope.newTeam.password1.length <6 && $scope.newTeam.password1.length > 0){
                            $scope.errorMessage = {
                                message:'格式错误',
                                flag:true
                            };
                            return false;
                        }
                    }else if(index == 'pwd2' && $scope.newTeam.password1 !== $scope.newTeam.password2) {
                        $scope.errorMessage = {
                            message:'两次密码不一致',
                            flag:true
                        };
                        return false;
                    }else{
                        $scope.errorMessage = {
                            message:'',
                            flag:false
                        };
                        return true;
                    }

                }

                $scope.personAdd=function () {
                    $("#person_add").modal("show");
                    $scope.personPredata={
                        username:'',
                        nickname:'',
                        sms:'',
                        password1:'',
                        password2:''
                    }
                    $scope.form.$setPristine();
                    $scope.form.$setUntouched();
                }

                $scope.memberChange = function(){
                    $scope.personPredata.nickname = "";
                    if(!$rootScope.phoneCheck($scope.personPredata.username)){
                        $scope.error = {
                            errorMessageShow: true,
                            errorMessage: "手机号格式不符合规则"
                        };
//                        $scope.userVerify = {
//                            code:"wrong",
//                            message: ""
//                        };
                    }else {
                        $scope.error.errorMessageShow = $scope.error.errorMessageShow ? false : null;
                        //用户存在
                        $http({method:"GET",url:"/company/user/show?username="+$scope.personPredata.username}).then(
                            function (result) {
                                if(result.data.code == 0){
                                    $scope.personPredata.nickname = result.data.data.nickname;
                                    $scope.userVerify = {
                                        code: "right",
                                        message:"用户存在，可直接添加"
                                    };
                                    $timeout(function () {
                                        $scope.addPerson =function () {
                                            if($scope.personPredata.username === '' || $scope.personPredata.nickname === '' || $scope.personPredata.sms === ''){
                                                vaildstr("请完善信息");
                                                return 0;
                                            }
                                            $http({method:"GET",url:"/company/user/add?username="+$scope.personPredata.username+"&sms="+$scope.personPredata.sms}).then(
                                                function (result) {
                                                    $timeout(function () {
                                                        if(result.data.status === 'fail'){
                                                            vaildstr(result.data.message);
                                                        }else{
                                                            $("#person_add").modal("hide");
                                                            $rootScope.infoBox("成员添加成功");
                                                            $scope.companyFlag = false;
                                                            $scope.getMemberList(7,0);
                                                        }
                                                    },0,false);
                                                })
                                        }
                                    },0,false)
                                }else{
                                    $scope.userVerify = {
                                        code: "wrong",
                                        message:"用户不存在，请先注册"
                                    };
                                    $scope.addPerson =function () {
                                        for(var key in $scope.personPredata){
                                            if($scope.personPredata[key] === ''){
                                                vaildstr('请先完善信息');
                                                return 0 ;
                                            }
                                        }
                                        $http({method:"POST",url:"/company/user/registerAdd",data:$scope.personPredata}).then(
                                            function (result) {
                                                $timeout(function () {
                                                    if(result.data.status === "fail"){
                                                        vaildstr(result.data.message);
                                                    }else {
                                                        $("#person_add").modal("hide");
                                                        $rootScope.infoBox("添加成功");
                                                        $scope.companyFlag = false;
                                                        $scope.getMemberList(7,0);
                                                    }
                                                });
                                            })
                                    }
                                }
                            }
                        )

                    }
                }


                //获取成员下下拉列表
                $scope.getMembers =function () {
                    $http({method: "GET", url: "/company/teamMoving/employeesList"}).then(
                        function (result) {
                            $scope.memberList = result.data.data;
                        })
                };

                $scope.changeManager = function () {
                    if ($scope.changeTeam.turnsms.length === 6 && $scope.changeTeam.changeTo !== undefined && $scope.changeTeam.changeTo !== ""){
                        $http({method:"GET",url:"/company/teamMoving?id="+$scope.changeTeam.changeTo + "&sms=" + $scope.changeTeam.turnsms}).then(
                            function (result) {
                                if(result.data.status === "success"){
                                    $timeout(function () {
                                        $("#team_turn_on").modal("hide");
                                        $rootScope.infoBox("移交成功");
                                        location.href="/logout";
                                    },0,false)
                                }else {
                                    $rootScope.infoBox(result.data.message);
                                }
                            }
                        )
                    }else {
                        $scope.error = {
                            errorMessageShow: true,
                            errorMessage: "请完善所填信息"
                        }
                    }
                };

                $scope.deleteMember = function (id) {
                    $http({method:"GET",url:"/company/employeesList/delete/"+id}).then(
                        function (result) {
                            if(result.data.status === 'success'){
                                $rootScope.infoBox("删除成功");
                            }else{
                                $rootScope.infoBox("删除失败");
                            }
                            $scope.companyFlag = false;
                            $scope.getMemberList(7,0);
                        }
                    )
                };

                //2次密码是否一致
                $scope.isIdentical = false;
                $scope.passwdIdentical=function () {
                    if($scope.personPredata.password1 === $scope.personPredata.password2){
                        $scope.isIdentical = false;
                    }else {
                        $scope.isIdentical = true;
                    }
                }

                layui.use('element', function(){
                    var $ = layui.jquery
                        ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
                    $timeout(function () {
                        if(!($rootScope.myinfo.role.name === 'ROLE_MANAGER' && $rootScope.myinfo.superiorMember)){
                            element.tabChange('employee_list', "companyMember")
                            //$("#companyMember").click();

                        }
                    },0,false)
                });

                $scope.changeRole = function (id) {
                    $http.get("/user/roleUpdate/"+id).then(
                        function (result) {
                           if(result.data.status === 'success'){
                               $scope.getMemberList(7,0);
                           }else{
                               $rootScope.infoBox(result.data.message);
                           }

                        }
                    )
                };

                $scope.setImgUrl = function (url) {
                    $scope.biggerUrl = url;
                };

                //清除模态框
                $('#person_add').on('hide.bs.modal',
                    function() {
                        $scope.personPredata = {};
                        $scope.userVerify={};
                        $scope.smsInit();
                        $scope.errorMessage = {};
                        $scope.error ={};
                        $scope.$apply();
                });
                $("#team_turn_on").on('hide.bs.modal',
                    function () {
                        $scope.changeTeam = {};
                        $scope.smsInit();
                        $scope.errorMessage = {};
                        $scope.error ={};
                        $scope.$apply();
                });
                $("#create_team").on('hide.bs.modal',
                    function () {
                        $scope.newTeam = {};
                        $scope.errorMessage = {};
                        $scope.error ={};
                        $scope.teamVerifyCode = false;
                        $scope.smsInit();
                        $scope.$apply();
                    });


            }
    ]);
</script>
<div class="body_wrap list_wrap" ng-controller="employeeCtrl">
    <div class="wrapper-md clearfix" style="padding:50px 45px;">
        <div class="font-thin h4">
                    <!--企业成员-->
                        <form class="layui-form layui-row">
                            <div class="pull-left inline m-r">
                                <input type="text" class="form-control"
                                       placeholder="请输入姓名"
                                       ng-model="searchInfo.name"
                                       autocomplete="off">
                            </div>
                            <div class="pull-left inline m-r">
                                <input type="text" class="form-control"
                                       placeholder="请输入联系方式"
                                       ng-model="searchInfo.phone"
                                       autocomplete="off">
                            </div>
                            <div class="pull-left l-r inline" style="margin: 2px 15px">
                                <button class="layui-btn layui-btn-sm blueBtn"
                                        ng-click="searchMemberList()"
                                >查询
                                </button>
                                <button class="layui-btn layui-btn-sm layui-btn-primary blueBtn_primary"
                                        ng-click="clearSearchInfo()"
                                >清除
                                </button>
                            </div>

                            <div class="inline pull-right" ng-if="myinfo.role.name === 'ROLE_MANAGER' || myinfo.role.name === 'ROLE_LEADER'">
                                <button class="layui-btn layui-btn-sm layui-btn-primary"
                                        ng-click="personAdd()"
                                        data-toggle="modal">新增成员</button>
                                <button class="layui-btn layui-btn-sm layui-btn-primary"
                                        data-target="#team_turn_on"
                                        data-toggle="modal"
                                        ng-click="getMembers()"
                                        ng-if="myinfo.role.name === 'ROLE_MANAGER'">移交企业</button>
                                <button class="layui-btn layui-btn-sm layui-btn-primary"
                                        data-target="#create_team"
                                        data-toggle="modal"
                                        ng-if="myinfo.role.name === 'ROLE_MANAGER' && myinfo.superiorMember" >创建团队</button>
                            </div>
                        </form>
                        <table class="layui-table" style="margin: 30px 0px">
                            <colgroup>
                                <col width="150">
                                <col width="150">
                                <col width="200">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>姓名</th>
                                <th>联系方式</th>
                                <th>查询次数</th>
                                <th>所在团队</th>
                                <th>角色</th>
                                <th>加入团队时间</th>
                                <th ng-if="myinfo.role.name !== 'ROLE_EMPLOYEE'">操作</th>
                            </tr>
                            </thead>
                            <tbody class="membersList">
                            <tr ng-repeat="item in members">
                                <td>{{item.nickname}}</td>
                                <td>{{item.username}}</td>
                                <td>{{item.queryCount}}</td>
                                <td>{{item.superiorMember ? "--" : item.companyName}}</td>
                                <td>{{role(item.superiorMember,item.role.name)}}</td>
                                <td>{{item.joinCompanyTime | datetime}}</td>
                                <td ng-if="myinfo.role.name !== 'ROLE_EMPLOYEE'">
                                    <button class="layui-btn layui-btn-sm"
                                            ng-click="deleteMember(item.id)"
                                            ng-if="(myinfo.superiorMember === item.superiorMember) && (item.role.name === 'ROLE_EMPLOYEE'&& myinfo.role.name !== 'ROLE_EMPLOYEE') || (item.role.name === 'ROLE_LEADER'&& myinfo.role.name === 'ROLE_MANAGER')">删除</button>
                                    <button class="layui-btn layui-btn-sm layui-btn-normal"
                                            ng-click="changeRole(item.id)"
                                            ng-if=" (myinfo.superiorMember === item.superiorMember) && myinfo.role.name ==='ROLE_MANAGER' && item.role.name === 'ROLE_EMPLOYEE'">晋升</button>
                                    <button class="layui-btn layui-btn-sm layui-btn-danger"
                                            ng-click="changeRole(item.id)"
                                            ng-if="(myinfo.superiorMember === item.superiorMember) &&myinfo.role.name ==='ROLE_MANAGER' && item.role.name ==='ROLE_LEADER'">降级</button>
                                    <a ng-if="(myinfo.superiorMember !== item.superiorMember) || item.role.name === 'ROLE_MANAGER' || (item.role.name === myinfo.role.name)">--</a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div id="companyPage" class="pageBar" style="top: 521px"></div>
            </div>
            <!--新增成员模态框-->
            <div class="modal fade" id="person_add" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title">新增成员</h4>
                        </div>
                        <div class="modal-body contentFont">
                            <form class="form-horizontal" name="form" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-5 col-sm-offset-4 valid-form">
                                        <div class="valid-form-item" style="left: 15px;top: -12px;">
                                            <div>
                                                <span class="text-danger" ng-show= "isIdentical"><i class="fa fa-ban"></i> 两次密码不一致</span>
                                            </div>
                                            <div>
                                                <span class="text-danger" ng-show="form.passwd1.$dirty && form.passwd1.$invalid"><i class="fa fa-ban"></i> 密码不得小于6位</span>
                                            </div>
                                            <div>
                                                <span class="text-danger" ng-show="form.sms.$dirty && form.sms.$invalid"><i class="fa fa-ban"></i> 验证码格式不符合规则</span>
                                            </div>
                                            <div>
                                                <span class="text-danger" ng-show="form.nickname.$dirty && form.nickname.$invalid"><i class="fa fa-ban"></i> 请输入姓名</span>
                                            </div>
                                            <div>
                                                <span class="text-danger" ng-show="form.username.$dirty && form.username.$invalid"><i class="fa fa-ban"></i> 手机号格式不符合规则</span>
                                            </div>
                                            <div>
                                                <span class="text-danger" ng-show="error.errorMessageShow"><i class="fa fa-ban"></i> {{error.errorMessage}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">成员手机号：</label>
                                    <div class="col-sm-5" style="width:49.466667%;">
                                        <input class="form-control"  required name="username" ng-model="personPredata.username"  placeholder="请输入成员手机号" type="text" ng-change="memberChange()">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">成员姓名：</label>
                                    <div class="col-sm-5" style="width:49.466667%;">
                                        <input class="form-control" name="nickname" ng-model="personPredata.nickname" required  placeholder="请输入成员姓名" type="text">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">验证码：</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" name="sms" ng-minlength="6" ng-maxlength="6" maxlength="6" required ng-model="personPredata.sms"  placeholder="6位验证码" type="text">
                                    </div>
                                    <div class="col-sm-5" style="margin-left: -25px;">
                                        <button style="width:140px;"  class="btn btn-default" ng-hide="personSendSMSPending"  ng-click="personSms(personPredata.username)">获取短信验证码</button>
                                        <button style="width:140px;"  class="btn btn-default disabled" ng-show="personSendSMSPending">{{personSendSMSText}}</button>
                                    </div>
                                </div>
                                <div class="form-group" ng-if="userVerify.code === '' || userVerify.code === 'wrong'">
                                    <label class="col-sm-4 control-label">登录密码：</label>
                                    <div class="col-sm-5" style="width:49.466667%;">
                                        <input class="form-control" name="passwd1" required ng-minlength="6" ng-model="personPredata.password1"  placeholder="不得少于6位" type="password">
                                    </div>
                                </div>
                                <div class="form-group" ng-if="userVerify.code === '' || userVerify.code === 'wrong'">
                                    <label class="col-sm-4 control-label">确认密码：</label>
                                    <div class="col-sm-5" style="width:49.466667%">
                                        <input class="form-control" name="passwd2" required ng-minlength="6" ng-change="passwdIdentical()" ng-model="personPredata.password2"  placeholder="不得少于6位" type="password">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="clearSearch()">取消</button>
                            <button type="button" ng-disabled="form.$invalid" class="btn btn-primary" ng-click="addPerson()">确认</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--移交团队模态框-->
            <div class="modal fade" id="team_turn_on" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title">移交企业</h4>
                        </div>
                        <div class="modal-body contentFont">
                            <form class="form-horizontal" name="form" novalidate>
                                <div class="form-group">
                                    <div class="col-sm-5 col-sm-offset-4 valid-form">
                                        <div class="valid-form-item" style="left: 15px;top: -12px;">
                                            <div>
                                                <span class="text-danger" ng-show="form.sms.$dirty && form.sms.$invalid"><i class="fa fa-ban"></i> 验证码格式不符合规则</span>
                                            </div>
                                            <div>
                                                <span class="text-danger" ng-show="error.errorMessageShow"><i class="fa fa-ban"></i> {{error.errorMessage}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">原管理员手机号：</label>
                                    <div class="col-sm-5">
                                        <input class="form-control" name="managerPhone" ng-model="myinfo.username" disabled type="text">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">验证码：</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" name="sms" ng-model="changeTeam.turnsms" ng-minlength="6" ng-maxlength="6" placeholder="6位验证码" type="text">
                                    </div>
                                    <div class="col-sm-3" style="margin-left: -25px;">
                                        <button  class="btn btn-default" ng-hide="personSendSMSPending"  ng-click="personSms(myinfo.username)">获取验证码</button>
                                        <button  class="btn btn-default disabled" ng-show="personSendSMSPending">{{personSendSMSText}}</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-3 control-label">移交至：</label>
                                    <div class="col-sm-5">
                                        <select type="text"
                                                class="form-control"
                                                ng-model="changeTeam.changeTo"
                                                autocomplete="off"
                                                ng-options="member.id as member.nickName for member in memberList"
                                        >
                                            <option value="">请选择成员</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" ng-click="changeManager()">确认</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--新增团队模态框-->
            <div class="modal fade" id="create_team" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                            <h4 class="modal-title">创建团队</h4>
                        </div>
                        <div class="modal-body contentFont">
                            <form class="form-horizontal">
                                <div style="text-align: center;margin-bottom: 10px;height:19px;">
                                    <span class="text-danger" ng-show="errorMessage.flag"><i class="fa fa-ban"></i> {{errorMessage.message}}</span>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">团队名称：</label>
                                    <div class="col-sm-5">
                                        <input class="form-control" ng-change="checkForm('teamName')" ng-model="newTeam.name" type="text" placeholder="团队名称不超过20字">
                                    </div>

                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">联系方式：</label>
                                    <div class="col-sm-5">
                                        <input class="form-control" ng-model="newTeam.username" placeholder="请输入负责人联系方式" type="text" ng-change="leaderChange()">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">负责人姓名：</label>
                                    <div class="col-sm-5">
                                        <input class="form-control" ng-change="checkForm('name')" ng-model="newTeam.nickname"  placeholder="请输入负责人姓名" type="text">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">验证码：</label>
                                    <div class="col-sm-3">
                                        <input class="form-control" name="sms" ng-model="newTeam.sms"  placeholder="6位验证码" type="text">
                                    </div>
                                    <div class="col-sm-3" style="margin-left: -25px;">
                                        <button  class="btn btn-default" ng-hide="personSendSMSPending"  ng-click="personSms(newTeam.username)">获取验证码</button>
                                        <button  class="btn btn-default disabled" ng-show="personSendSMSPending">{{personSendSMSText}}</button>
                                    </div>
                                </div>
                                <div class="form-group" ng-if="teamVerifyCode">
                                    <label class="col-sm-4 control-label">登录密码：</label>
                                    <div class="col-sm-5">
                                        <input class="form-control" ng-change="checkForm('pwd1')" ng-blur="checkForm('pwd1')" name="name" ng-model="newTeam.password1"  placeholder="不得少于6位" type="password">
                                    </div>
                                </div>
                                <div class="form-group" ng-if="teamVerifyCode">
                                    <label class="col-sm-4 control-label">确认密码：</label>
                                    <div class="col-sm-5">
                                        <input class="form-control" ng-change="checkForm('pwd2')" ng-blur="checkForm('pwd2')" name="name" ng-model="newTeam.password2"  placeholder="不得少于6位" type="password">
                                    </div>
                                    <div class="col-lg-4" style="margin: 8px 0 0 -25px;">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="clearSearch()">取消</button>
                            <button type="button" class="btn btn-primary" ng-click="addTeam()">确认</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--查看营业执照-->
        <div class="modal fade bs-example-modal-lg text-center" id="bigger_picture" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" >
            <div class="modal-dialog modal-lg" style="display: inline-block; width: auto;">
                <div class="modal-content">
                    <img src="{{biggerUrl}}" style="max-width: 700px;max-height: 480px">
                </div>
            </div>
        </div>
    <div class="footer_wrap">
        <div class="pull-right">
            杭州商道科技有限公司 &nbsp;
            0571-56932575
        </div>
    </div>
</div>
